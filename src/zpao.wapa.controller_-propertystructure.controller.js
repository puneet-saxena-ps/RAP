sap.ui.define(["com/public/storage/pao/utils/reusecontroller","sap/m/BusyDialog","sap/m/MessageToast","sap/ui/core/Fragment","com/public/storage/pao/utils/formatter","sap/ui/model/json/JSONModel","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/u+
i/model/FilterType"],function(e,t,o,i,r,l,s,n,a){"use strict";var u;return e.extend("com.public.storage.pao.controller.PropertyStructure",{formatter:r,onInit:function(){u=this;const e=this.getRouter();e.getRoute("propStructure").attachMatched(this._onRou+
teMatched,this);this._oBusyDialog=new t;this.getView().addDependent(this._oBusyDialog)},_onRouteMatched:function(e){const t=this.getRouter();this.getOwnerComponent.hasChanges=false;const o=this.getOwnerComponent().plant;if(o===undefined){return t.navTo("+
home")}const i=this.getOwnerComponent().LegacyPropertyNumber;this._oModel=sap.ui.getCore().getModel("mainModel");this.readPropertyData(o,i);this.readOrgStructure();this.readHierarachy();if(this.getView().getModel("treeModel")){this.getView().getModel("tr+
eeModel").setData([])}},buildTree:function(e){var t={};e.forEach(function(e){if(e.__metadata){delete e.__metadata}if(!t[e.LevelId]){t[e.LevelId]=e;t[e.LevelId].children=[]}else{t[e.LevelId]=Object.assign(t[e.LevelId],e)}var o=parseInt(e.LevelId)-1;if(o>=+
0){if(!t[o].children){t[o].children=[]}t[o].children.push(t[e.LevelId])}});var o=Object.values(t).filter(function(e){return parseInt(e.LevelId)===0});return o},onCollapseAll:function(e){const t=this.byId("treeTable");const o=e.getSource().getState();if(o+
){t.expandToLevel(10)}else{t.collapseAll()}},_onValueHelpOrgStruc:function(e){const t=this;const o=this.getView();if(!this._pValueHelpFieldSup){this._pValueHelpFieldSup=i.load({id:o.getId(),name:"com.public.storage.pao.fragments.PropertyStructure.OrgStru+
cture",controller:this}).then(function(e){o.addDependent(e);return e})}this._oBusyDialog.open();this._pValueHelpFieldSup.then(function(e){t._oBusyDialog.close();e.open()})},_onValueHelpHier:function(){const e=this;const t=this.getView();if(!this._pValueH+
elpSupOff){this._pValueHelpSupOff=i.load({id:t.getId(),name:"com.public.storage.pao.fragments.PropertyStructure.Hierarchy",controller:this}).then(function(e){t.addDependent(e);return e})}this._oBusyDialog.open();this._pValueHelpSupOff.then(function(t){e.+
_oBusyDialog.close();t.open()})},onValueHelpDialogClose:function(e){var t=e.getParameter("selectedItem");let o=e.getSource().getTitle();if(!t){return}if(o==="Org Structure"){let e=t.getDescription();this._sCodeOrg=t.getTitle();this.getView().getModel("pl+
antBasicDetailsModel").setProperty("/OrgStruct",`(${this._sCodeOrg}) ${e}`);this.byId("hier").setEnabled(true);this.byId("hier").setValue("")}if(o==="Hierarchy Code"){let e=t.getDescription();let o=t.getTitle();this.getView().getModel("plantBasicDetailsM+
odel").setProperty("/HierCode",`(${o}) ${e}`);this.callTreeService(o,this._sCodeOrg)}},onValueHelpDialogSearchHierStruct:function(e){let t=e.getParameter("value");let o=new s("Description",n.Contains,t);e.getSource().getBinding("items").filter([o])},onVa+
lueHelpDialogSearchOrgStruct:function(e){let t=e.getParameter("value");let o=new s("Description",n.Contains,t);e.getSource().getBinding("items").filter([o])},callTreeService:function(e,t){const i=this;let r=new sap.ui.model.Filter("LegacyPropertyNumber",+
"EQ",this.getOwnerComponent().LegacyPropertyNumber);let s=new sap.ui.model.Filter("OrgStruct","EQ",t);let n=new sap.ui.model.Filter("HierCode","EQ",e);this._oBusyDialog.open();this._oModel.read(`/PropertyHierarchySet`,{filters:[r,s,n],success:function(e)+
{i._oBusyDialog.close();i.byId("treeTable").setVisible(true);const t=i.buildTree(e.results);const r=new l(t[0]);i.getView().setModel(r,"treeModel");i.getView().getModel("treeModel").refresh();if(!t.length){return o.show("No Data Found")}i.byId("treeTable+
").expandToLevel(10)},error:function(e){i._oBusyDialog.close();i.byId("treeTable").setVisible(false);if(e.responseText){const t=JSON.parse(e.responseText).error.message.value;if(t.includes("Cost Center Group")){o.show(t);i.getView().getModel("treeModel")+
.setData([])}else{o.show("No Date Found");i.getView().getModel().setData([])}}else{o.show("Something went wrong with the service");i.getView().getModel().setData([])}}})}})});                                                                                
//# sourceMappingURL=PropertyStructure.controller.js.map                                                                                                                                                                                                       